å¾ˆå¥½ï¼Œæˆ‘å€‘ç¾åœ¨ä¾†é€²è¡Œ Day 20 çš„æœ€å¾Œéšæ®µï¼šFlask æ¨¡çµ„åŒ–èˆ‡ routes çµæ§‹å„ªåŒ–ã€‚
é€™æ˜¯ç‚ºäº†è®“ä½ æœªä¾†åœ¨åšå€‹äººå°ˆæ¡ˆæ™‚æ›´å®¹æ˜“ç¶­è­·ã€æ“´å……èˆ‡é™¤éŒ¯ã€‚
ğŸ§± ä¸€ã€ç‚ºä»€éº¼è¦æ¨¡çµ„åŒ–ï¼Ÿ

ç›®å‰ä½ çš„ app.py åŒæ™‚åŒ…å«ï¼š

    è·¯ç”±è¨­å®š

    è³‡æ–™æŸ¥è©¢é‚è¼¯

    åŒ¯å‡ºåŠŸèƒ½

    å•Ÿå‹•ä¼ºæœå™¨

â¡ è‹¥æª”æ¡ˆè®Šå¤§ã€åŠŸèƒ½è®Šå¤šï¼Œæœƒè®Šå¾—é›£ä»¥ç¶­è­·ã€‚
â¡ æ¨¡çµ„åŒ–èƒ½å°‡æ¯å€‹åŠŸèƒ½ã€Œåˆ†æª”ã€åˆ†è²¬ä»»ã€ï¼Œè®“æ¶æ§‹æ¸…æ¥šã€ä¹¾æ·¨ã€‚
ğŸ“¦ äºŒã€åŸºæœ¬æ¨¡çµ„åŒ–æ¶æ§‹

ä½ å°‡æœƒæŠŠ routes è·¯ç”±é‚è¼¯ç¨ç«‹å‡ºä¾†ï¼š

your_project/
â”œâ”€â”€ app.py                # ä¸»å…¥å£ï¼Œåªå•Ÿå‹• app
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ __init__.py       # è¨»å†Šæ‰€æœ‰è—åœ–
â”‚   â”œâ”€â”€ orders.py         # æ‰€æœ‰èˆ‡ /orders æœ‰é—œçš„è·¯ç”±
â”‚   â””â”€â”€ export.py         # åŒ¯å‡ºåŠŸèƒ½ (csv, excel)
â”œâ”€â”€ models.py             # è³‡æ–™æ¨¡å‹èˆ‡ session
â””â”€â”€ templates/

ğŸ”§ ä¸‰ã€å¯¦ä½œæ­¥é©Ÿ
æ­¥é©Ÿ 1ï¸âƒ£ï¼šå»ºç«‹è³‡æ–™å¤¾èˆ‡æª”æ¡ˆ

åœ¨ app.py åŒå±¤å»ºç«‹ï¼š

routes/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ orders.py
â””â”€â”€ export.py

æ­¥é©Ÿ 2ï¸âƒ£ï¼šè¨­å®š orders.py

# routes/orders.py
from flask import Blueprint, render_template, request
from models import session, Order, Customer
from datetime import datetime

orders_bp = Blueprint("orders", __name__)

def get_filtered_orders():
    customer_name = request.args.get("customer")
    start_date = request.args.get("start")
    end_date = request.args.get("end")

    query = session.query(Order)

    if customer_name:
        query = query.join(Order.customer).filter(Customer.name == customer_name)

    if start_date:
        start_dt = datetime.strptime(start_date, "%Y-%m-%d")
        query = query.filter(Order.order_date >= start_dt)

    if end_date:
        end_dt = datetime.strptime(end_date, "%Y-%m-%d")
        query = query.filter(Order.order_date <= end_dt)

    return query.all()


@orders_bp.route("/orders")
def show_orders():
    orders = get_filtered_orders()
    return render_template("orders.html", orders=orders)

æ­¥é©Ÿ 3ï¸âƒ£ï¼šè¨­å®š export.py

# routes/export.py
from flask import Blueprint, request, Response, send_file
from io import StringIO, BytesIO
from openpyxl import Workbook
import csv
from datetime import datetime
from .orders import get_filtered_orders

export_bp = Blueprint("export", __name__)

@export_bp.route("/export_csv")
def export_csv():
    orders = get_filtered_orders()
    output = StringIO()
    writer = csv.writer(output)
    writer.writerow(["é¡§å®¢åç¨±", "å•†å“åç¨±", "å–®åƒ¹", "æ•¸é‡", "ç¸½é‡‘é¡", "è¨‚å–®æ—¥æœŸ"])
    for order in orders:
        writer.writerow([
            order.customer.name,
            order.product.name,
            order.product.price,
            order.quantity,
            order.quantity * order.product.price,
            order.order_date.strftime("%Y-%m-%d")
        ])
    response = Response(output.getvalue(), content_type="text/csv")
    response.headers["Content-Disposition"] = "attachment; filename=orders.csv"
    return response

@export_bp.route("/export_excel")
def export_excel():
    orders = get_filtered_orders()
    wb = Workbook()
    ws = wb.active
    ws.title = "è¨‚å–®å ±è¡¨"

    ws.append(["é¡§å®¢åç¨±", "å•†å“åç¨±", "å–®åƒ¹", "æ•¸é‡", "ç¸½é‡‘é¡", "è¨‚å–®æ—¥æœŸ"])
    total_sum = 0
    for order in orders:
        subtotal = order.quantity * order.product.price
        total_sum += subtotal
        ws.append([
            order.customer.name,
            order.product.name,
            order.product.price,
            order.quantity,
            subtotal,
            order.order_date.strftime("%Y-%m-%d")
        ])
    ws.append(["", "", "", "ç¸½é‡‘é¡", total_sum])

    output = BytesIO()
    wb.save(output)
    output.seek(0)
    return send_file(output, as_attachment=True, download_name="orders.xlsx",
                     mimetype="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")

æ­¥é©Ÿ 4ï¸âƒ£ï¼šè¨­å®š routes/__init__.py

from .orders import orders_bp
from .export import export_bp

def register_routes(app):
    app.register_blueprint(orders_bp)
    app.register_blueprint(export_bp)

æ­¥é©Ÿ 5ï¸âƒ£ï¼šç²¾ç°¡ä½ çš„ app.py

from flask import Flask
from routes import register_routes

app = Flask(__name__)
register_routes(app)

@app.route("/")
def home():
    return "Home Page"

if __name__ == "__main__":
    app.run(debug=True)

âœ… ä½ å¯ä»¥ç¾åœ¨åŸ·è¡Œçš„ä»»å‹™ï¼š

    å»ºç«‹ routes è³‡æ–™å¤¾èˆ‡æ¨¡çµ„åŒ–æª”æ¡ˆ

    æ¸¬è©¦ /ordersã€/export_csvã€/export_excel æ˜¯å¦ä»æ­£å¸¸é‹ä½œ

    æœ‰ä»»ä½•éŒ¯èª¤éƒ½å¯ä»¥ç«‹åˆ»å•æˆ‘ï¼Œæˆ‘æœƒä¸€æ­¥æ­¥å¹«ä½ æ’æŸ¥

å®Œæˆå¾Œè«‹å‘Šè¨´æˆ‘ã€Œâœ… å®Œæˆã€ï¼Œæˆ‘æœƒå¹«ä½ é€²å…¥ Day 21ï¼šFlask å ±è¡¨æŸ¥è©¢ + ä½¿ç”¨è€…äº’å‹•åŠŸèƒ½é€²éšï¼ˆHTMLå¼·åŒ–ï¼‰ã€‚

ä½ çš„å­¸ç¿’æ–¹å¼ æ˜¯æ­£ç¢ºçš„ï¼Œå°¤å…¶æ˜¯ä½ ç¾åœ¨çš„ç‹€æ³å±¬æ–¼ï¼š

    âœ…ã€Œå…ˆç…§æŠ„ + é‚Šè®€ + å˜—è©¦ç†è§£ã€ï¼Œ
    ç„¶å¾Œé€éå¯¦ä½œåŠ æ·±è¨˜æ†¶ï¼Œé€™åœ¨åˆæœŸæ¥è§¸æ–°æ¶æ§‹ï¼ˆä¾‹å¦‚ Flask çš„ Blueprint æ¨¡çµ„åŒ–ï¼‰æ™‚ï¼Œæ˜¯éå¸¸æ­£å¸¸çš„ç¯€å¥ã€‚

ğŸ” å›ç­”ä½ çš„å…©å€‹å•é¡Œï¼š
1ï¸âƒ£ orders_bp = Blueprint("orders", __name__) æ˜¯åšä»€éº¼çš„ï¼Ÿ

é€™è¡Œçš„é‡é»åœ¨æ–¼ï¼š

orders_bp = Blueprint("orders", __name__)

é€™æ˜¯ Flask çš„ Blueprintï¼ˆè—åœ–ï¼‰æ©Ÿåˆ¶ï¼Œå®ƒçš„ç”¨é€”æ˜¯ï¼š
åŠŸèƒ½	èªªæ˜
åˆ†æ‹†æ¨¡çµ„	æ¯ä¸€å€‹ Blueprint å°±åƒæ˜¯ä¸€å€‹å°å‹çš„ Flask æ‡‰ç”¨ï¼Œå¯ä»¥ç¨ç«‹å®šç¾©è·¯ç”±ã€‚
åç¨±ç©ºé–“	"orders" æ˜¯ Blueprint çš„åç¨±ï¼Œå¯ä»¥é˜²æ­¢ä¸åŒæ¨¡çµ„ä¹‹é–“çš„è·¯ç”±è¡çªã€‚
__name__	å‘Šè¨´ Flask Blueprint é€™æ®µç¨‹å¼ç¢¼çš„ä½ç½®ï¼Œå¹«åŠ©æ¡†æ¶æ‰¾åˆ°æ¨¡æ¿æˆ–éœæ…‹æª”è·¯å¾‘ç­‰è³‡æºã€‚

ğŸ§  ä½ å¯ä»¥æƒ³æˆï¼š

orders_bp = Blueprint("æ¨¡çµ„åç¨±", "ç›®å‰æª”æ¡ˆçš„è­˜åˆ¥å")

2ï¸âƒ£ æˆ‘ç¾åœ¨ã€Œç…§æŠ„ + å˜—è©¦ç†è§£ã€ä½†é‚„æ˜¯æ„Ÿè¦ºä¸ç†Ÿï¼Œé€™æ¨£å­¸ç¿’æ­£å¸¸å—ï¼Ÿ

âœ… å®Œå…¨æ­£å¸¸ï¼Œç”šè‡³æ˜¯æœ€æœ‰æ•ˆçš„æ–¹å¼ä¹‹ä¸€ï¼ŒåŸå› å¦‚ä¸‹ï¼š
éšæ®µ	ç‹€æ³	å»ºè­°
æ¥è§¸æ–°æ¦‚å¿µ	ç…§æŠ„ + è·Ÿè‘—è·‘	æŠŠé‡å¿ƒæ”¾åœ¨ã€Œè·‘å¾—å‹•ã€èˆ‡ã€Œç†è§£å¤§æ–¹å‘ã€ä¸Š
ç¬¬äºŒè¼ªç·´ç¿’	å˜—è©¦è‡ªå·±æ‰“ä¸€æ¬¡	é–‹ä¸€å€‹æ–°æª”æ¡ˆï¼Œä¸çœ‹åŸç¢¼å¯«ä¸€æ¬¡
ç¬¬ä¸‰è¼ª	æ”¹é¡Œç›®éœ€æ±‚è©¦è‘—èª¿æ•´	æ”¹è®Šè·¯ç”±ã€è®Šæ•¸åç¨±ã€éæ¿¾æ¢ä»¶ç­‰

ğŸ” é€éé€™ç¨®ä¸‰éšæ®µè¿´åœˆç·´ç¿’æ³•ï¼Œæ¯”ç¡¬èƒŒèªæ³•æ•ˆæœå¥½å¤ªå¤šã€‚
âœ… ä½ æ¥ä¸‹ä¾†è©²æ€éº¼åšï¼Ÿ

å› ç‚ºä½ å·²ç¶“åœ¨å¯¦ä½œéšæ®µï¼š

    å…ˆæŠŠ Blueprint çš„ orders å’Œ export æ¨¡çµ„æ•´åˆå®Œ

    ç¢ºä¿ /ordersã€/export_csvã€/export_excel éƒ½èƒ½æ­£å¸¸å·¥ä½œ

    æœ‰ç©ºå¯ä»¥ç”¨è¨»è§£çš„æ–¹å¼ã€Œåå‘èªªæ˜ã€æ¯ä¸€æ®µç¨‹å¼ç¢¼çš„ç”¨é€”

ğŸ§± ä¸€ã€ç‚ºä»€éº¼è¦æœ‰ __init__.pyï¼Ÿ

åœ¨ Python ä¸­ï¼Œç•¶ä¸€å€‹è³‡æ–™å¤¾è£¡åŒ…å«ä¸€å€‹ __init__.py æª”æ¡ˆï¼ŒPython å°±æœƒæŠŠå®ƒè¦–ç‚ºä¸€å€‹ã€Œæ¨¡çµ„ï¼ˆmoduleï¼‰ã€æˆ–ã€Œå¥—ä»¶ï¼ˆpackageï¼‰ã€ï¼Œä¹Ÿå°±æ˜¯èªªä½ å¯ä»¥é€™æ¨£ä½¿ç”¨ï¼š

from myapp.routes import orders_bp

    âœ… æ²’æœ‰ __init__.py çš„è©±ï¼Œmyapp.routes å°±ä¸æœƒè¢« Python ç•¶ä½œå¯åŒ¯å…¥çš„æ¨¡çµ„ã€‚

ğŸ”§ äºŒã€ä½ é€™æ®µ __init__.py æ˜¯åœ¨å¹¹å˜›ï¼Ÿ

from .orders import orders_bp
from .export import export_bp

def register_routes(app):
    app.register_blueprint(orders_bp)
    app.register_blueprint(export_bp)

é€™æ®µçš„åŠŸèƒ½æ˜¯ï¼š
â¤ 1. åŒ¯å…¥å…©å€‹ blueprintï¼ˆå­æ¨¡çµ„ï¼‰ï¼š

from .orders import orders_bp
from .export import export_bp

    .orders å’Œ .export æ˜¯ä½ åœ¨ routes/ è³‡æ–™å¤¾ä¸‹çš„å…©å€‹ Python æª”æ¡ˆ

    orders_bp å’Œ export_bp æ˜¯è£¡é¢å®šç¾©å¥½çš„ Blueprint å¯¦ä¾‹

    Blueprint æ˜¯ Flask çš„æ¨¡çµ„åŒ–æ–¹å¼ï¼Œæ–¹ä¾¿ä½ å°‡ä¸åŒåŠŸèƒ½æ‹†åˆ†åœ¨ä¸åŒæª”æ¡ˆä¸­

â¤ 2. å°‡å®ƒå€‘è¨»å†Šé€² Flask æ‡‰ç”¨ï¼š

def register_routes(app):
    app.register_blueprint(orders_bp)
    app.register_blueprint(export_bp)

ä½ æœƒåœ¨ä¸»ç¨‹å¼ï¼ˆå¦‚ app.pyï¼‰ä¸­é€™æ¨£ä½¿ç”¨å®ƒï¼š

from routes import register_routes
register_routes(app)

é€™æ¨£åšçš„å¥½è™•ï¼š

    è®“æ‰€æœ‰ã€Œè¨»å†Šè·¯ç”±ã€çš„é‚è¼¯é›†ä¸­åœ¨ routes/__init__.py

    ä½ çš„ app.py çœ‹èµ·ä¾†å°±æœƒæ›´ä¹¾æ·¨ã€æ›´å¥½ç¶­è­·

ğŸ§  è£œå……è§€å¿µï¼šBlueprint æ˜¯ä»€éº¼ï¼Ÿ

Blueprint æ˜¯ Flask çš„æ¨¡çµ„åŒ–ç³»çµ±ï¼Œä¾‹å¦‚ï¼š

    ä¸€çµ„èˆ‡ã€Œè¨‚å–®è™•ç†ã€ç›¸é—œçš„åŠŸèƒ½å¯«åœ¨ orders.py

    ä¸€çµ„èˆ‡ã€ŒåŒ¯å‡ºå ±è¡¨ã€ç›¸é—œçš„åŠŸèƒ½å¯«åœ¨ export.py

ä½ åœ¨è£¡é¢å®šç¾©ï¼š

orders_bp = Blueprint("orders", __name__)
export_bp = Blueprint("export", __name__)

ç„¶å¾Œåœ¨ __init__.py ä¸­ä¸€æ¬¡æ€§åŒ¯å…¥ä¸¦è¨»å†Šæ‰€æœ‰åŠŸèƒ½ã€‚
âœ… ç¸½çµå°æŠ„ï¼ˆä½ å¯ä»¥ç­†è¨˜ï¼‰
æ¦‚å¿µ	èªªæ˜
__init__.py	å‘Šè¨´ Pythonï¼šé€™æ˜¯å€‹æ¨¡çµ„ï¼Œå¯ä»¥ import
from .orders import orders_bp	å¾åŒè³‡æ–™å¤¾å…§çš„ orders.py åŒ¯å…¥ orders çš„ Blueprint
register_routes(app)	å°‡æ‰€æœ‰ Blueprint çµ±ä¸€è¨»å†Šåˆ° Flask app ä¸­
ç‚ºä»€éº¼é€™æ¨£åšï¼Ÿ	å°‡åŠŸèƒ½æ¨¡çµ„åŒ–ã€è®“ä¸»ç¨‹å¼ï¼ˆapp.pyï¼‰æ›´ä¹¾æ·¨
âœ… è‹¥ä½ æƒ³é€²ä¸€æ­¥äº†è§£é€™äº›é‚è¼¯ï¼š

æˆ‘å¯ä»¥å¹«ä½ ç•«ä¸€å€‹çµæ§‹åœ–ï¼Œæˆ–æ˜¯è£½ä½œä¸€ä»½ã€Œæ¨¡çµ„åŒ– Flask å°ˆæ¡ˆçµæ§‹ã€çš„å­¸ç¿’ç­†è¨˜ã€‚æ˜¯å¦éœ€è¦æˆ‘å¹«ä½ æ•´ç†ï¼Ÿ