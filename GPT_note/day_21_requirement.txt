ğŸ“˜ Day 21ï¼šå ±è¡¨æ•´åˆèˆ‡æ¨¡çµ„åŒ–è¨­è¨ˆï¼ˆå€‹äººå°ˆæ¡ˆå‰çš„é å‚™ï¼‰
ğŸ¯ æ ¸å¿ƒç›®æ¨™ï¼š

    å½ˆæ€§æŸ¥è©¢æ¨¡çµ„æ•´åˆï¼ˆå·²å®Œæˆï¼‰

    è¼¸å‡ºåŠŸèƒ½æ¨¡çµ„åŒ–ï¼ˆå·²å®Œæˆï¼‰

    Blueprint èˆ‡ init.py çµæ§‹ç†è§£ï¼ˆå·²å®Œæˆï¼‰

    âœ… æ–°ä¸»é¡Œï¼šå»ºç«‹å®Œæ•´ã€Œå ±è¡¨æœå‹™æ¨¡çµ„ã€ï¼Œå«ä¸‹åˆ—åŠŸèƒ½ï¼š

        å½ˆæ€§è¼¸å‡º Excel/CSV

        è‡ªå‹•å‘½åä¸‹è¼‰æª”æ¡ˆï¼ˆåŠ ä¸Šæ—¥æœŸæ™‚é–“ï¼‰

        æ•´åˆå¤šç­†æŸ¥è©¢æ¢ä»¶

        å¢åŠ éŒ¯èª¤è™•ç†ï¼ˆå¦‚æœç„¡è³‡æ–™æ™‚é¡¯ç¤ºæç¤ºï¼‰

ğŸ”§ Day 21 å­¸ç¿’æ­¥é©Ÿè¦åŠƒï¼š
ğŸ§© Part 1ï¼šä¸‹è¼‰æª”æ¡ˆè‡ªå‹•åŠ ä¸Šæ—¥æœŸæ™‚é–“

    âœ… ç¤ºç¯„å¦‚ä½•åœ¨æª”åå¾ŒåŠ ä¸Š orders_20250604.csv é€™ç¨®æ ¼å¼

ğŸ§© Part 2ï¼šç„¡è³‡æ–™æç¤ºèˆ‡éŒ¯èª¤è™•ç†

    å¦‚æœæ²’æœ‰ç¬¦åˆæŸ¥è©¢çš„è¨‚å–®ï¼Œä¸ä¸‹è¼‰ç©ºæª”ï¼Œè€Œæ˜¯è¿”å›è¨Šæ¯æˆ–å°å›é é¢

ğŸ§© Part 3ï¼šæ–°å¢ã€ŒæŸ¥è©¢æ¢ä»¶æ‘˜è¦ã€é¡¯ç¤ºåœ¨ HTML ä¸Š

    é¡¯ç¤ºç›®å‰çš„æŸ¥è©¢æ¢ä»¶ï¼ˆå¦‚ï¼šé¡§å®¢åç¨±ã€æ—¥æœŸç¯„åœï¼‰

ğŸ§© Part 4ï¼ˆå¯é¸ï¼‰ï¼šå ±è¡¨åŠ ç¸½è³‡è¨Šä¸€ä½µåŒ¯å‡ºåˆ°æª”æ¡ˆåº•éƒ¨

æˆ‘æœƒå¾ç¬¬ä¸€å€‹ã€Œè‡ªå‹•å‘½åä¸‹è¼‰æª”æ¡ˆã€é–‹å§‹ï¼Œå¹«ä½ ç¤ºç¯„ä¸¦åˆ†è§£èªªæ˜é‚è¼¯èˆ‡ç¨‹å¼ç¢¼ã€‚

æº–å‚™å¥½äº†å—ï¼Ÿæˆ‘å€‘ç«‹åˆ»é–‹å§‹ Day 21ï¼šPart 1ã€‚

ğŸ§­ ç¾åœ¨é€²å…¥ Day 21 Part 1
ğŸ¯ ç›®æ¨™ï¼šå ±è¡¨ä¸‹è¼‰è‡ªå‹•å‘½å

    è®“ä¸‹è¼‰çš„æª”åæ ¹æ“šæŸ¥è©¢æ¢ä»¶è‡ªå‹•è®ŠåŒ–ï¼Œå¦‚ï¼š

        orders_å°æ˜.csv

        orders_2024-01-01_to_2024-02-01.xlsx

        orders_å°æ˜_2024-01-01_to_2024-02-01.csv

ğŸ§© æ­¥é©Ÿè¦åŠƒï¼š

    æ–°å¢å‡½å¼ generate_filename() â†’ æ ¹æ“šæŸ¥è©¢æ¢ä»¶è‡ªå‹•ç”¢ç”Ÿæª”æ¡ˆåç¨±

    åŒ¯å‡º CSV æ™‚ä½¿ç”¨é€™å€‹å‡½å¼çš„æª”å

    åŒ¯å‡º Excel æ™‚ä¹Ÿä½¿ç”¨é€™å€‹å‡½å¼çš„æª”å

ğŸ›  ç¬¬ä¸€æ­¥ï¼šå»ºç«‹ generate_filename() å‡½å¼

ä½ å¯ä»¥å…ˆåœ¨ utils.py å»ºç«‹ä»¥ä¸‹å…§å®¹ï¼ˆæˆ–æš«æ™‚å¯«åœ¨ export.py ä¸­ï¼‰ï¼š

def generate_filename(customer_name=None, start_date=None, end_date=None, filetype="csv"):
    filename = "orders"
    if customer_name:
        filename += f"_{customer_name}"
    if start_date and end_date:
        filename += f"_{start_date}_to_{end_date}"
    elif start_date:
        filename += f"_{start_date}_and_after"
    elif end_date:
        filename += f"_before_{end_date}"
    return f"{filename}.{filetype}"

ğŸ§ª æ¸¬è©¦é€™å€‹å‡½å¼ï¼ˆå¯åœ¨ Python Console æ¸¬è©¦ï¼‰ï¼š

print(generate_filename("å°æ˜", "2024-01-01", "2024-02-01", "xlsx"))
# ğŸ‘‰ orders_å°æ˜_2024-01-01_to_2024-02-01.xlsx

âœ… ä¿®æ”¹å¾Œçš„ export_csv ç¯„ä¾‹ï¼š

from flask import Response
from io import StringIO
import csv

@app.route("/export_csv")
def export_csv():
    orders = get_filtered_orders()
    customer_name = request.args.get("customer")
    start_date = request.args.get("start")
    end_date = request.args.get("end")

    output = StringIO()
    writer = csv.writer(output)
    writer.writerow(["é¡§å®¢åç¨±", "å•†å“åç¨±", "å–®åƒ¹", "æ•¸é‡", "ç¸½é‡‘é¡", "è¨‚å–®æ—¥æœŸ"])
    for order in orders:
        writer.writerow([
            order.customer.name,
            order.product.name,
            order.product.price,
            order.quantity,
            order.quantity * order.product.price,
            order.order_date.strftime("%Y-%m-%d")
        ])

    filename = generate_filename(customer_name, start_date, end_date, "csv")
    response = Response(output.getvalue(), content_type="text/csv")
    response.headers["Content-Disposition"] = f"attachment; filename={filename}"
    return response

âœ… ä¿®æ”¹å¾Œçš„ export_excel ç¯„ä¾‹ï¼š

from flask import send_file
from io import BytesIO
from openpyxl import Workbook

@app.route("/export_excel")
def export_excel():
    orders = get_filtered_orders()
    customer_name = request.args.get("customer")
    start_date = request.args.get("start")
    end_date = request.args.get("end")

    wb = Workbook()
    ws = wb.active
    ws.title = "è¨‚å–®å ±è¡¨"
    ws.append(["é¡§å®¢åç¨±", "å•†å“åç¨±", "å–®åƒ¹", "æ•¸é‡", "ç¸½é‡‘é¡", "è¨‚å–®æ—¥æœŸ"])
    for order in orders:
        ws.append([
            order.customer.name,
            order.product.name,
            order.product.price,
            order.quantity,
            order.quantity * order.product.price,
            order.order_date.strftime("%Y-%m-%d")
        ])

    output = BytesIO()
    wb.save(output)
    output.seek(0)

    filename = generate_filename(customer_name, start_date, end_date, "xlsx")
    return send_file(
        output,
        as_attachment=True,
        download_name=filename,
        mimetype="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
    )