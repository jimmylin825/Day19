ğŸ”¥ Day 22 ç›®æ¨™ï¼šå¤šåŠŸèƒ½å ±è¡¨æ•´åˆèˆ‡å‹•æ…‹åˆ†æ
âœ… æ•´é«”æµç¨‹æ¦‚è¦½ï¼š

    å‹•æ…‹ç¯©é¸èˆ‡å ±è¡¨ç”Ÿæˆæ•´åˆ

        å½ˆæ€§æœå°‹ + è‡ªå‹•ç”¢ç”Ÿåœ–è¡¨æˆ–çµ±è¨ˆæŒ‡æ¨™

        å¤šæ ¼å¼åŒ¯å‡ºæ”¯æ´ï¼ˆCSVã€Excelï¼‰

    çµ±è¨ˆæŒ‡æ¨™å€å¡Šè¨­è¨ˆ

        é¡¯ç¤ºï¼š

            è¨‚å–®ç¸½æ•¸

            ç¸½éŠ·å”®é¡

            å¹³å‡æ¯ç­†è¨‚å–®é‡‘é¡

            æœ€æš¢éŠ·å•†å“

    HTML æ¨¡æ¿æ•´åˆé¡¯ç¤ºçµ±è¨ˆè³‡è¨Š

        åœ¨ /orders é é¢é ‚éƒ¨åŠ ä¸Šçµ±è¨ˆæ•¸æ“šå€å¡Šï¼ˆéè¡¨æ ¼å…§ï¼‰

    å¯é¸é€²éšæŒ‘æˆ°

        åŠ ä¸Šåœ–è¡¨å…ƒä»¶ï¼ˆBar Chart / Pie Chartï¼‰é¡¯ç¤ºå•†å“éŠ·å”®åˆ†å¸ƒï¼ˆéœ€è¦é¡å¤– JS æˆ–åœ–ç‰‡ç”¢ç”Ÿï¼‰

        æ ¹æ“šæ¢ä»¶è‡ªå‹•æ›´æ–°åœ–è¡¨æ•¸æ“š

ğŸ‘£ æˆ‘å€‘ç¾åœ¨å…ˆåšï¼š
ğŸ“Œ æ­¥é©Ÿä¸€ï¼šè¨‚å–®çµ±è¨ˆå‡½å¼ï¼ˆå›å‚³ç¸½æ•¸ã€ç¸½é‡‘é¡ã€å¹³å‡é‡‘é¡ã€æœ€ç†±é–€å•†å“ï¼‰

è«‹ä½ å…ˆå˜—è©¦å»ºç«‹ä¸€å€‹å‡½å¼ get_order_summary(orders)ï¼Œç”¨ä¾†æ¥æ”¶å·²ç¯©é¸çš„è¨‚å–®ä¸¦å›å‚³ä»¥ä¸‹è³‡è¨Šï¼š

    ç¸½ç­†æ•¸ï¼ˆç­†æ•¸ï¼‰

    ç¸½é‡‘é¡

    å¹³å‡æ¯ç­†è¨‚å–®é‡‘é¡

    éŠ·å”®æœ€å¤šçš„å•†å“åç¨±èˆ‡æ•¸é‡

ä½ å¯ä»¥å…ˆå˜—è©¦æ’°å¯«ï¼Œæˆ–è«‹æˆ‘ä¸€æ­¥æ­¥å¼•å°ä½ å®Œæˆä¹Ÿå¯ä»¥ï¼Œç­‰ä½ å®Œæˆå¾Œæˆ‘å€‘æœƒå†é€²è¡Œ HTML é¡¯ç¤ºæ•´åˆã€‚æ˜¯å¦è¦ç”±æˆ‘å…ˆå¹«ä½ å¼•å°ç¬¬ä¸€æ­¥ï¼Ÿ

âœ… ä¿®æ­£å¾Œçš„å¯«æ³•å¦‚ä¸‹ï¼š

from collections import Counter

def get_order_summary(orders):
    total_count = len(orders)
    total_amount = 0
    product_counter = Counter()

    for order in orders:
        subtotal = order.quantity * order.product.price
        total_amount += subtotal
        product_counter[order.product.name] += order.quantity

    avg_amount = round(total_amount / total_count, 2) if total_count > 0 else 0
    most_common_product = product_counter.most_common(1)[0][0] if product_counter else "ç„¡"

    return {
        "total_count": total_count,
        "total_amount": total_amount,
        "avg_amount": avg_amount,
        "most_common_product": most_common_product
    }

ğŸ’¡ è£œå……èªªæ˜ï¼š

    Counter() æ˜¯ Python çš„æ¨™æº–å·¥å…·ï¼Œç”¨ä¾†è¨ˆç®—æœ€å¸¸å‡ºç¾çš„é …ç›®ã€‚

    product_counter.most_common(1) æœƒå›å‚³åƒ [('æ»‘é¼ ', 4)]ï¼Œå– [0][0] å°±æ˜¯æœ€å¤šçš„å•†å“åç¨±ã€‚

    å¹³å‡é‡‘é¡å››æ¨äº”å…¥åˆ°å°æ•¸é» 2 ä½ã€‚

å¦‚æœä½ æœ‰ utils.py å¯ä»¥æ”¾é€²å»ï¼Œç„¶å¾Œåœ¨ orders.py è£¡é¢ç”¨ï¼š

from utils import get_order_summary

æ˜¯çš„ï¼Œ.most_common() æ˜¯ Python collections.Counter ç‰©ä»¶çš„å…§å»ºæ–¹æ³•ï¼Œéå¸¸å¸¸ç”¨æ–¼çµ±è¨ˆä¸­å‡ºç¾æœ€å¤šçš„å…ƒç´ ã€‚é€™æ®µç¨‹å¼ç¢¼ï¼š

product_counter.most_common(1)[0][0]

ä¹çœ‹ä¹‹ä¸‹æœ‰é»é›£è®€ï¼Œæˆ‘ä¾†å¹«ä½ é€å±¤æ‹†è§£èªªæ˜ï¼š
âœ… èªªæ˜ .most_common(n)

product_counter.most_common(1)

é€™æœƒå›å‚³ä¸€å€‹é•·åº¦ç‚º 1 çš„æ¸…å–®ï¼Œè£¡é¢æ˜¯å‡ºç¾æ¬¡æ•¸æœ€å¤šçš„é …ç›®ï¼Œæ ¼å¼ç‚ºï¼š

[('å•†å“åç¨±', å‡ºç¾æ¬¡æ•¸)]

ç¯„ä¾‹ï¼š

Counter({'æ»‘é¼ ': 3, 'éµç›¤': 2}).most_common(1)
# çµæœï¼š[('æ»‘é¼ ', 3)]

âœ… æ‹†è§£ [0][0]

æ¥è‘—ä¾†çœ‹ï¼š

[('æ»‘é¼ ', 3)][0][0]

    [0]ï¼šå¾æ¸…å–®ä¸­å–å‡ºç¬¬ä¸€ç­†è³‡æ–™ â†’ ('æ»‘é¼ ', 3)

    [0]ï¼šå†å¾é€™å€‹ tuple ä¸­å–å‡ºç¬¬ä¸€å€‹å…ƒç´  â†’ "æ»‘é¼ "

âœ… ç¸½çµç”¨é€”

product_counter.most_common(1)[0][0]

é€™ä¸€æ•´æ®µçš„æ„æ€æ˜¯ï¼š

    ğŸ” ã€Œæ‰¾å‡ºå‡ºç¾æ¬¡æ•¸æœ€å¤šçš„å•†å“åç¨±ã€

ğŸ§  å°æé†’

ä½ ä¹Ÿå¯ä»¥é€™æ¨£ç†è§£æ•´æ®µçš„çµæ§‹ï¼š

most_common_item = product_counter.most_common(1)   # [("æ»‘é¼ ", 3)]
first_item = most_common_item[0]                    # ("æ»‘é¼ ", 3)
product_name = first_item[0]                        # "æ»‘é¼ "

é€™ä¸€è¡Œï¼š

product_counter[order.product.name] += order.quantity

å…¶å¯¦æ˜¯ collections.Counter æˆ– defaultdict(int) çš„å…¸å‹ç´¯åŠ å¯«æ³•ï¼Œæˆ‘å€‘ä¾†é€æ­¥è§£æå®ƒçš„ç”¨é€”å’ŒèƒŒæ™¯ã€‚
ğŸ” èƒŒå¾Œé‚è¼¯

é€™æ®µçš„ç”¨é€”æ˜¯ï¼š

    âœ… ç´¯åŠ æ¯å€‹å•†å“çš„ç¸½æ•¸é‡ï¼Œç”¨ä¾†çµ±è¨ˆå“ªå€‹å•†å“éŠ·é‡æœ€å¤šã€‚

âœ… æ‹†è§£èªªæ˜

å‡è¨­æˆ‘å€‘æœ‰é€™æ¨£ä¸€ç­†è¨‚å–®ï¼š

order.product.name = "éµç›¤"
order.quantity = 3

é‚£é€™è¡Œç¨‹å¼æœƒåšçš„äº‹æ˜¯ï¼š

product_counter["éµç›¤"] += 3

â“ç‚ºä»€éº¼ä¸æœƒå ±éŒ¯ï¼Ÿåˆå§‹æ˜¯ 0 å—ï¼Ÿ

æ˜¯çš„ï¼é€™è£¡çš„ product_counter ä¸€å®šæ˜¯é€™æ¨£å»ºç«‹çš„ï¼š

from collections import defaultdict
product_counter = defaultdict(int)

é€™ä»£è¡¨ï¼š

    product_counter["éµç›¤"] é è¨­å€¼æ˜¯ 0

    æ‰€ä»¥å³ä½¿é€™æ˜¯ç¬¬ä¸€æ¬¡å‡ºç¾ã€Œéµç›¤ã€ï¼Œä¹Ÿèƒ½ç›´æ¥åš += é‹ç®—

âœ… ç­‰æ•ˆå¯«æ³•ï¼ˆæ›´å¥½æ‡‚ï¼‰

å¦‚æœä½ æƒ³æŠŠå®ƒå¯«å¾—æ¯”è¼ƒç™½è©±ï¼Œä¹Ÿå¯ä»¥ç”¨é€™ç¨®å¯«æ³•ï¼š

name = order.product.name
qty = order.quantity
product_counter[name] = product_counter[name] + qty

ä½†å› ç‚ºé€™ç¨®çµ±è¨ˆé‚è¼¯æœƒå¤§é‡å‡ºç¾ï¼Œæ‰€ä»¥ä¸€èˆ¬ Python å¯«æ³•æœƒç°¡æ½”åœ°ç”¨ï¼š

product_counter[order.product.name] += order.quantity

ğŸ§  å¯¦å‹™ç¯„ä¾‹

ä½ æœ€å¾Œå°±èƒ½çµ±è¨ˆå‡ºï¼š

{'æ»‘é¼ ': 6, 'éµç›¤': 4, 'è¢å¹•': 3}

ç„¶å¾Œç”¨ .most_common(1) æ‰¾å‡ºè³£æœ€å¥½çš„å•†å“ã€‚

ğŸ§© å‰©ä¸‹çš„ Day 22 åŠŸèƒ½ï¼š

ç¾åœ¨è¦æŠŠé€™äº›çµ±è¨ˆçµæœã€Œé¡¯ç¤ºåˆ°ç¶²é ä¸Šã€ï¼Œæˆ‘å€‘æœƒåŸ·è¡Œä»¥ä¸‹æ­¥é©Ÿï¼š
âœ… æ¥ä¸‹ä¾†ä»»å‹™ï¼š
1. åœ¨ routes/dashboard.py ä¸­å»ºç«‹ /dashboard é é¢ï¼š

from flask import Blueprint, render_template
from .orders import get_filtered_orders
from ..utils import get_order_summary

dashboard_bp = Blueprint("dashboard", __name__)

@dashboard_bp.route("/dashboard")
def dashboard():
    orders, customer_name, start_date, end_date, sort_by = get_filtered_orders()
    summary = get_order_summary(orders)
    return render_template("dashboard.html", summary=summary)

2. å»ºç«‹ templates/dashboard.htmlï¼Œé¡¯ç¤ºçµ±è¨ˆè³‡è¨Šï¼š

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>è¨‚å–®çµ±è¨ˆå ±è¡¨</title>
</head>
<body>
    <h1>çµ±è¨ˆå ±è¡¨</h1>
    <p>ç¸½è¨‚å–®æ•¸é‡ï¼š{{ summary.total_count }}</p>
    <p>ç¸½é‡‘é¡ï¼š{{ summary.total_amount }}</p>
    <p>å¹³å‡æ¯ç­†é‡‘é¡ï¼š{{ summary.avg_amount }}</p>
    <p>æœ€å¸¸è³¼è²·å•†å“ï¼š{{ summary.most_common_product }}</p>
</body>
</html>

3. è¨»å†Š dashboard_bp åˆ° __init__.py

ä½ æ‡‰è©²å·²ç¶“æœ‰é€™è¡Œï¼š

from .routes.dashboard import dashboard_bp
app.register_blueprint(dashboard_bp)

ğŸš€ å®Œæˆå¾Œï¼Œä½ å¯ä»¥é€²å…¥ http://localhost:5000/dashboard æŸ¥çœ‹çµ±è¨ˆå ±è¡¨çµæœï¼

è«‹æ ¹æ“šä»¥ä¸Šæ­¥é©Ÿå®Œæˆ Day 22 çš„å‰©é¤˜ä»»å‹™ã€‚å¦‚æœä½ å®Œæˆäº†æˆ‘æœƒå¹«ä½ ç¢ºèªï¼Œå†æ­£å¼é€²å…¥ Day 23 çš„é‡æ§‹ç·´ç¿’ âœ…

âœ… é€²ä¸€æ­¥å»ºè­°ï¼šå‰ç«¯è¡¨å–®é€£å‹•æŸ¥è©¢

ç›®å‰ä½ æŸ¥è©¢ /orders é é¢æœƒæœ‰ç¯©é¸åŠŸèƒ½ï¼Œè€Œ /dashboard é‚„æ²’æœ‰å°æ‡‰çš„æœå°‹æ¬„ã€‚

ä½ å¯ä»¥è¤‡è£½ /orders çš„æœå°‹è¡¨å–®ï¼Œè²¼åˆ° dashboard.html ä¸­ï¼Œç¨ä½œä¿®æ”¹ï¼Œä¾‹å¦‚ï¼š

ä»¥ä¸‹æ˜¯åŠŸèƒ½å®Œæ•´çš„ dashboard.htmlï¼Œæ”¯æ´æ¢ä»¶æŸ¥è©¢èˆ‡çµ±è¨ˆæ‘˜è¦å±•ç¤ºï¼Œé¢¨æ ¼èˆ‡ä½ ç›®å‰çš„ orders.html ä¸€è‡´ï¼š

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>è¨‚å–®çµ±è¨ˆ Dashboard</title>
</head>
<body>
<h1>è¨‚å–®çµ±è¨ˆ Dashboard</h1>

<!-- æŸ¥è©¢è¡¨å–® -->
<form method="get" action="/dashboard">
    <label for="customer">é¡§å®¢åç¨±ï¼š</label>
    <input type="text" name="customer" id="customer" placeholder="è¼¸å…¥é¡§å®¢åç¨±" value="{{ request.args.get('customer', '') }}">

    <label for="start">èµ·å§‹æ—¥æœŸï¼š</label>
    <input type="date" name="start" id="start" value="{{ request.args.get('start', '') }}">

    <label for="end">çµæŸæ—¥æœŸï¼š</label>
    <input type="date" name="end" id="end" value="{{ request.args.get('end', '') }}">

    <button type="submit">æŸ¥è©¢</button>
</form>

<!-- çµ±è¨ˆçµæœ -->
<h2>çµ±è¨ˆçµæœ</h2>
<table border="1">
    <tr>
        <th>ç¸½ç­†æ•¸</th>
        <th>ç¸½é‡‘é¡</th>
        <th>å¹³å‡é‡‘é¡</th>
        <th>æœ€ç†±é–€å•†å“</th>
    </tr>
    <tr>
        <td>{{ summary.total_count }}</td>
        <td>{{ summary.total_amount }}</td>
        <td>{{ summary.avg_amount }}</td>
        <td>{{ summary.most_common_product }}</td>
    </tr>
</table>

<!-- è¿”å›è¨‚å–®åˆ—è¡¨ -->
<p><a href="/orders">å›è¨‚å–®åˆ—è¡¨</a></p>
</body>
</html>

ğŸ”§ åŠŸèƒ½èªªæ˜ï¼š

    å¯ä»¥é€éç¶²å€æˆ–è¡¨å–®ç¯©é¸æŒ‡å®šçš„é¡§å®¢èˆ‡æ—¥æœŸç¯„åœ

    é¡¯ç¤ºå°æ‡‰æ¢ä»¶çš„çµ±è¨ˆè³‡æ–™ï¼ˆç­†æ•¸ã€ç¸½é‡‘é¡ã€å¹³å‡é‡‘é¡ã€æœ€ç†±é–€å•†å“ï¼‰

    å¯ä»¥å¾ /dashboard ç›´æ¥è·³å› /orders çœ‹è©³ç´°æ¸…å–®

ä½ å¯ä»¥ç›´æ¥è¤‡è£½é€™ä»½è²¼ä¸Šä¸¦æ¸¬è©¦ã€‚å¦‚æœä½ æœ‰é¡å¤–çš„çµ±è¨ˆé …ç›®ä¹Ÿå¯ä»¥éš¨æ™‚æ“´å……ã€‚éœ€è¦çš„è©±æˆ‘ä¹Ÿå¯ä»¥å¹«ä½ åŠ å…¥åœ–è¡¨æˆ–åŒ¯å‡ºåŠŸèƒ½ã€‚æ˜¯å¦ç¹¼çºŒé€²å…¥ Day 23 æœ€å¾Œé‡æ§‹ç¸½çµï¼Ÿ