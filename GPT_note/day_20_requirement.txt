ğŸ“˜ Day 20 ä¸»é¡Œï¼šæ¢ä»¶æŸ¥è©¢èˆ‡å½ˆæ€§å ±è¡¨è¼¸å‡º
ğŸ¯ã€Day 20 å…¨é«”æµç¨‹ç¸½è¦½ã€‘ï¼š
éšæ®µ	ä»»å‹™å…§å®¹	èªªæ˜
â‘ 	é¡¯ç¤ºæ‰€æœ‰è¨‚å–®ï¼ˆä½ å·²å®Œæˆï¼‰	/orders
â‘¡	é¡§å®¢æ¢ä»¶æŸ¥è©¢	/orders?customer=å°æ˜
â‘¢	æ—¥æœŸå€é–“æŸ¥è©¢	/orders?start=2024-01-01&end=2024-03-01
â‘£	é¡§å®¢ + å€é–“é›™æ¢ä»¶æŸ¥è©¢	/orders?customer=å°æ˜&start=2024-01-01&end=2024-03-01
â‘¤	åŒ¯å‡ºå ±è¡¨ï¼ˆCSV/Excelï¼‰	é¡¯ç¤ºè³‡æ–™ä¸‹æ–¹åŠ ä¸€å€‹æŒ‰éˆ•ï¼šä¸‹è¼‰å ±è¡¨
ğŸ”„	å¼·åŒ–ç·´ç¿’é¡Œ	é¡å¤–åŠ åˆ†æŒ‘æˆ°ï¼ˆåˆ†çµ„çµ±è¨ˆã€æœˆéŠ·å”®ç­‰ï¼‰
ğŸ”¹ ä»Šæ—¥å­ä»»å‹™ï¼ˆæ­¥é©Ÿâ‘¡ï¼‰ï¼šé¡§å®¢åç¨±æŸ¥è©¢æ¢ä»¶ /orders?customer=å°æ˜
âœ… æ•´é«”æµç¨‹æ­¥é©Ÿèªªæ˜ï¼š
æ­¥é©Ÿ	èªªæ˜
1ï¸âƒ£	åœ¨ /orders ä¸­è®€å–ç¶²å€çš„ request.args.get("customer")
2ï¸âƒ£	å¦‚æœæœ‰è¼¸å…¥ï¼Œå°±åœ¨ SQLAlchemy ä¸­åŠ å…¥ .filter() æ¢ä»¶
3ï¸âƒ£	å°‡æŸ¥è©¢çµæœå‚³å…¥ orders.html
4ï¸âƒ£	æ¸¬è©¦ç¶²å€ï¼šhttp://127.0.0.1:5000/orders?customer=å°æ˜ æ˜¯å¦æ­£ç¢ºé¡¯ç¤ºè³‡æ–™
5ï¸âƒ£	åœ¨ç¶²é æœ€ä¸Šæ–¹åŠ ä¸€å€‹æœå°‹æ¬„ï¼ˆå¯é¸å¼·åŒ–ï¼‰
ğŸ“Œ æ‰€éœ€æ–°çŸ¥ï¼š

    from flask import request

    request.args.get("åƒæ•¸åç¨±")

    .filter() çµåˆ .like() æˆ– == åšæŸ¥è©¢

âœ… ä»»å‹™ç›®æ¨™ï¼šé¡§å®¢åç¨±æŸ¥è©¢ /orders?customer=å°æ˜
ğŸ”¸ Step 1ï¼šå¼•å…¥ request ç‰©ä»¶

åœ¨ä½ çš„ Flask ç¨‹å¼é ‚éƒ¨åŠ å…¥ï¼š

from flask import Flask, render_template, request

ğŸ”¸ Step 2ï¼šä¿®æ”¹ /orders çš„æŸ¥è©¢é‚è¼¯

æ›´æ–°ä½ çš„ /orders è·¯ç”±å¦‚ä¸‹ï¼š

@app.route("/orders")
def show_orders():
    customer_name = request.args.get("customer")

    query = session.query(Order)

    if customer_name:
        query = query.join(Order.customer).filter(Customer.name == customer_name)

    orders = query.all()
    return render_template("orders.html", orders=orders)

ğŸ” èªªæ˜ï¼š
ä»£ç¢¼	åŠŸèƒ½
request.args.get("customer")	å¾ç¶²å€åƒæ•¸å–å¾—é¡§å®¢åç¨±
query.join(Order.customer)	æŠŠ Order å’Œ Customer åšé—œè¯æŸ¥è©¢
.filter(Customer.name == ...)	åªä¿ç•™ç¬¦åˆæ¢ä»¶çš„çµæœ
query.all()	å–å‡ºæœ€çµ‚çµæœè³‡æ–™
âœ… æ¸¬è©¦ç¶²å€ï¼š

http://127.0.0.1:5000/orders?customer=å°æ˜

å¦‚æœé¡¯ç¤ºæ­£ç¢º â†’ âœ… æˆåŠŸç¯©é¸å‡ºåªæœ‰ã€Œå°æ˜ã€çš„è¨‚å–®
ğŸ§  é€²éšæç¤ºï¼ˆå¯é¸ï¼‰ï¼š

    å¦‚æœä½ æƒ³è®“é—œéµå­—æ¨¡ç³ŠæŸ¥è©¢ï¼Œå¯ä»¥æ”¹æˆï¼š

.filter(Customer.name.like(f"%{customer_name}%"))

é€™æ¨£æ‰“ã€Œå°ã€ä¹Ÿæœƒé¡¯ç¤ºã€Œå°æ˜ã€ã€ã€Œå°ç¾ã€ã€ã€Œå°å¼·ã€ç­‰ã€‚

âœ… ä»»å‹™ç›®æ¨™ï¼šé¡§å®¢åç¨±æŸ¥è©¢ /orders?customer=å°æ˜
ğŸ”¸ Step 1ï¼šå¼•å…¥ request ç‰©ä»¶

åœ¨ä½ çš„ Flask ç¨‹å¼é ‚éƒ¨åŠ å…¥ï¼š

from flask import Flask, render_template, request

ğŸ”¸ Step 2ï¼šä¿®æ”¹ /orders çš„æŸ¥è©¢é‚è¼¯

æ›´æ–°ä½ çš„ /orders è·¯ç”±å¦‚ä¸‹ï¼š

@app.route("/orders")
def show_orders():
    customer_name = request.args.get("customer")

    query = session.query(Order)

    if customer_name:
        query = query.join(Order.customer).filter(Customer.name == customer_name)

    orders = query.all()
    return render_template("orders.html", orders=orders)

ğŸ” èªªæ˜ï¼š
ä»£ç¢¼	åŠŸèƒ½
request.args.get("customer")	å¾ç¶²å€åƒæ•¸å–å¾—é¡§å®¢åç¨±
query.join(Order.customer)	æŠŠ Order å’Œ Customer åšé—œè¯æŸ¥è©¢
.filter(Customer.name == ...)	åªä¿ç•™ç¬¦åˆæ¢ä»¶çš„çµæœ
query.all()	å–å‡ºæœ€çµ‚çµæœè³‡æ–™
âœ… æ¸¬è©¦ç¶²å€ï¼š

http://127.0.0.1:5000/orders?customer=å°æ˜

å¦‚æœé¡¯ç¤ºæ­£ç¢º â†’ âœ… æˆåŠŸç¯©é¸å‡ºåªæœ‰ã€Œå°æ˜ã€çš„è¨‚å–®
ğŸ§  é€²éšæç¤ºï¼ˆå¯é¸ï¼‰ï¼š

    å¦‚æœä½ æƒ³è®“é—œéµå­—æ¨¡ç³ŠæŸ¥è©¢ï¼Œå¯ä»¥æ”¹æˆï¼š

.filter(Customer.name.like(f"%{customer_name}%"))

é€™æ¨£æ‰“ã€Œå°ã€ä¹Ÿæœƒé¡¯ç¤ºã€Œå°æ˜ã€ã€ã€Œå°ç¾ã€ã€ã€Œå°å¼·ã€ç­‰ã€‚

ğŸ§  Flask èªæ³•å°æŠ„ï¼ˆè™•ç†ç¶²å€åƒæ•¸ï¼‰
èªæ³•	èªªæ˜	ç¯„ä¾‹
request.args.get("æ¬„ä½å")	å–å¾—ç¶²å€åƒæ•¸	/orders?customer=å°æ˜ â†’ request.args.get("customer") å›å‚³ "å°æ˜"
ğŸ§  SQLAlchemy æŸ¥è©¢èªæ³•å°æŠ„
èªæ³•	èªªæ˜	ç¯„ä¾‹
session.query(è³‡æ–™è¡¨)	å»ºç«‹æŸ¥è©¢ç‰©ä»¶	session.query(Order)
.join(é—œè¯åç¨±)	ç”¢ç”Ÿè³‡æ–™è¡¨é—œè¯	.join(Order.customer)ï¼ˆéœ€æœ‰ relationshipï¼‰
.filter(æ¢ä»¶)	ç¯©é¸è³‡æ–™	.filter(Customer.name == "å°æ˜")
.all()	å–å¾—æ‰€æœ‰è³‡æ–™ï¼ˆlistï¼‰	orders = query.all()
.first()	åªå–ç¬¬ä¸€ç­†è³‡æ–™	query.first()
.order_by(æ¬„ä½)	æ’åºè³‡æ–™	.order_by(Order.order_date.desc())
ğŸ§  Jinja2 æ¨¡æ¿èªæ³•å°æŠ„ï¼ˆHTML é¡¯ç¤ºç”¨ï¼‰
èªæ³•	åŠŸèƒ½	ç¯„ä¾‹
{{ è®Šæ•¸ }}	è¼¸å‡ºè®Šæ•¸å…§å®¹	{{ order.customer.name }}
{% for item in æ¸…å–® %}	è¿´åœˆ	{% for order in orders %}
{% set è®Šæ•¸ = å€¼ %}	å»ºç«‹æˆ–æ›´æ–°è®Šæ•¸	{% set total = 0 %}
è®Šæ•¸.æ–¹æ³•()	å‘¼å«æ–¹æ³•	{{ order.order_date.strftime("%Y-%m-%d") }}
ğŸ”„ Flask è·¯ç”±æŸ¥è©¢é‚è¼¯ï¼ˆç¯„ä¾‹ï¼‰

@app.route("/orders")
def show_orders():
    customer_name = request.args.get("customer")
    query = session.query(Order)

    if customer_name:
        query = query.join(Order.customer).filter(Customer.name == customer_name)

    orders = query.all()
    return render_template("orders.html", orders=orders)

